<!-- frontend/index.html -->
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SIS ‚Äî Dashboard</title>
<meta name="description" content="Student Information System Admin Dashboard ‚Äî demo frontend">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/css/style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>

<aside id="sidebar" class="sidebar shadow-lg" aria-label="Sidebar navigation">
  <div class="sidebar-top px-3 py-4 d-flex align-items-center">
    <img src="assets/images/placeholder-avatar.png" alt="logo" class="me-2 rounded-circle" width="44" height="44"/>
    <div>
      <h5 class="m-0">College SIS</h5>
      <small class="text-muted">Admin Panel</small>
    </div>
    <button id="sidebarCollapse" class="btn btn-sm btn-link ms-auto d-lg-none text-white" aria-label="Toggle sidebar">
      <i class="bi bi-list"></i>
    </button>
  </div>
  <nav class="nav flex-column px-2" role="navigation">
    <a class="nav-link active" href="index.html"><i class="bi bi-speedometer2 me-2"></i> Dashboard</a>
  <a class="nav-link" href="/students/"><i class="bi bi-people me-2"></i> Students</a>
    <a class="nav-link" href="add_student.html"><i class="bi bi-person-plus me-2"></i> Add Student</a>
    <a class="nav-link" href="attendance.html"><i class="bi bi-calendar-check me-2"></i> Attendance</a>
    <a class="nav-link" href="marks.html"><i class="bi bi-journal-text me-2"></i> Marks</a>
    <a class="nav-link mt-3 text-danger" href="login.html"><i class="bi bi-box-arrow-right me-2"></i> Logout</a>
  </nav>
  <div class="sidebar-footer px-3 mt-auto pb-4">
    <small class="text-muted">¬© 2025 College</small>
  </div>
</aside>

<main id="mainContent" class="main-content" role="main">
  <header class="topbar shadow-sm d-flex align-items-center justify-content-between px-4" role="banner">
    <div class="d-flex align-items-center">
      <button id="sidebarToggle" class="btn btn-outline-dark d-none d-lg-inline me-3" aria-label="Toggle sidebar">
        <i class="bi bi-list"></i>
      </button>
      <div>
        <h4 class="mb-0">Dashboard</h4>
        <small class="text-muted">Academic Overview & Statistics</small>
      </div>
    </div>

    <div class="d-flex align-items-center">
      <button id="darkModeToggle" class="btn btn-outline-secondary btn-sm me-3" title="Toggle Dark Mode">
        <i class="bi bi-moon-stars"></i>
      </button>
      <div class="me-3 text-end d-none d-md-block">
        <div class="small text-muted">Welcome back,</div>
        <strong class="text-primary">Admin User</strong>
      </div>
      <img class="avatar-sm rounded-circle" src="assets/images/placeholder-avatar.png" alt="admin avatar">
    </div>
  </header>

  <section class="container-fluid p-4">
    <!-- Quick Stats -->
    <div class="row g-4 mb-4">
      <div class="col-sm-6 col-lg-3">
        <div class="card stat-card h-100 border-0">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-gradient-1 me-3 flex-shrink-0"><i class="bi bi-people-fill"></i></div>
            <div class="flex-grow-1">
              <p class="text-muted mb-1 small text-uppercase fw-semibold">Total Students</p>
              <h2 class="mb-0 fw-bold" id="statStudents">--</h2>
              <small class="text-success"><i class="bi bi-arrow-up me-1"></i>+5% this month</small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3">
        <div class="card stat-card h-100 border-0">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-gradient-2 me-3 flex-shrink-0"><i class="bi bi-calendar-check-fill"></i></div>
            <div class="flex-grow-1">
              <p class="text-muted mb-1 small text-uppercase fw-semibold">Attendance</p>
              <h2 class="mb-0 fw-bold" id="statAttendance">--</h2>
              <small class="text-info"><i class="bi bi-calendar3 me-1"></i>Records logged</small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3">
        <div class="card stat-card h-100 border-0">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-gradient-3 me-3 flex-shrink-0"><i class="bi bi-journal-text"></i></div>
            <div class="flex-grow-1">
              <p class="text-muted mb-1 small text-uppercase fw-semibold">Subjects</p>
              <h2 class="mb-0 fw-bold" id="statSubjects">--</h2>
              <small class="text-muted"><i class="bi bi-book me-1"></i>Active courses</small>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-3">
        <div class="card stat-card h-100 border-0">
          <div class="card-body d-flex align-items-center">
            <div class="icon-circle bg-gradient-4 me-3 flex-shrink-0"><i class="bi bi-file-earmark-bar-graph"></i></div>
            <div class="flex-grow-1">
              <p class="text-muted mb-1 small text-uppercase fw-semibold">Marks Entries</p>
              <h2 class="mb-0 fw-bold" id="statMarks">--</h2>
              <small class="text-muted">Updated today</small>
              <small class="text-success"><i class="bi bi-trophy me-1"></i>Assessments</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts & Activity -->
    <div class="row mt-4 g-4">
      <div class="col-lg-8">
        <div class="card h-100 border-0">
          <div class="card-header bg-white border-bottom">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <div>
                <h5 class="mb-1 fw-bold"><i class="bi bi-bar-chart-line-fill me-2 text-primary"></i>Performance Analytics</h5>
                <small class="text-muted">Student attendance & grade trends</small>
              </div>
              <div class="btn-group btn-group-sm" role="group">
                <button type="button" class="btn btn-outline-primary active" data-period="weekly">Weekly</button>
                <button type="button" class="btn btn-outline-primary" data-period="monthly">Monthly</button>
                <button type="button" class="btn btn-outline-primary" data-period="yearly">Yearly</button>
              </div>
            </div>
            <div class="row g-2">
              <div class="col-md-6">
                <label class="form-label small fw-semibold mb-1">Filter by Year</label>
                <select id="yearFilter" class="form-select form-select-sm">
                  <option value="" selected>All Years</option>
                  <option value="FY">FY (First Year)</option>
                  <option value="SY">SY (Second Year)</option>
                  <option value="TY">TY (Third Year)</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label small fw-semibold mb-1">Filter by Division</label>
                <select id="divisionFilter" class="form-select form-select-sm">
                  <option value="" selected>All Divisions</option>
                  <option value="A">Division A</option>
                  <option value="B">Division B</option>
                  <option value="C">Division C</option>
                </select>
              </div>
            </div>
          </div>
          <div class="card-body p-4">
            <canvas id="performanceChart" style="max-height: 300px;"></canvas>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card h-100 border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-1 fw-bold"><i class="bi bi-clock-history me-2 text-primary"></i>Recent Activities</h5>
            <small class="text-muted">Latest system updates</small>
          </div>
          <div class="card-body" style="max-height: 350px; overflow-y: auto;">
            <ul class="list-unstyled mb-0" id="recentActivity">
              <li class="mb-4 pb-3 border-bottom">
                <div class="d-flex align-items-start">
                  <div class="icon-circle bg-gradient-1 me-3 flex-shrink-0" style="width:40px;height:40px;font-size:0.95rem;">
                    <i class="bi bi-person-plus"></i>
                  </div>
                  <div class="flex-grow-1">
                    <p class="mb-1 fw-semibold">New Student Added</p>
                    <small class="text-muted"><i class="bi bi-clock me-1"></i>Demo seed data created</small>
                  </div>
                </div>
              </li>
              <li class="mb-4 pb-3 border-bottom">
                <div class="d-flex align-items-start">
                  <div class="icon-circle bg-gradient-2 me-3 flex-shrink-0" style="width:40px;height:40px;font-size:0.95rem;">
                    <i class="bi bi-calendar-check"></i>
                  </div>
                  <div class="flex-grow-1">
                    <p class="mb-1 fw-semibold">Attendance Marked</p>
                    <small class="text-muted"><i class="bi bi-clock me-1"></i>Today's attendance recorded</small>
                  </div>
                </div>
              </li>
              <li class="mb-4 pb-3 border-bottom">
                <div class="d-flex align-items-start">
                  <div class="icon-circle bg-gradient-3 me-3 flex-shrink-0" style="width:40px;height:40px;font-size:0.95rem;">
                    <i class="bi bi-journal-text"></i>
                  </div>
                  <div class="flex-grow-1">
                    <p class="mb-1 fw-semibold">Marks Updated</p>
                    <small class="text-muted"><i class="bi bi-clock me-1"></i>Midterm results published</small>
                  </div>
                </div>
              </li>
              <li>
                <div class="d-flex align-items-start">
                  <div class="icon-circle bg-gradient-4 me-3 flex-shrink-0" style="width:40px;height:40px;font-size:0.95rem;">
                    <i class="bi bi-bell"></i>
                  </div>
                  <div class="flex-grow-1">
                    <p class="mb-1 fw-semibold">System Updated</p>
                    <small class="text-muted"><i class="bi bi-clock me-1"></i>Enhanced UI deployed</small>
                  </div>
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="row mt-4 g-4">
      <div class="col-lg-6">
        <div class="card border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-1 fw-bold"><i class="bi bi-trophy-fill me-2 text-warning"></i>Top Performers</h5>
            <small class="text-muted">Based on overall academic performance</small>
          </div>
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center mb-4 p-3 rounded" style="background: linear-gradient(135deg, rgba(255,193,7,0.1), rgba(255,193,7,0.05));">
              <div class="d-flex align-items-center">
                <span class="me-3" style="font-size: 2rem;">ü•á</span>
                <div>
                  <p class="mb-0 fw-bold">Bhumi Gujarathi</p>
                  <small class="text-muted">TY Computer - A</small>
                </div>
              </div>
              <div class="text-end">
                <h4 class="mb-0 text-success fw-bold">96.8%</h4>
                <small class="text-muted">Avg Score</small>
              </div>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-4 p-3 rounded" style="background: linear-gradient(135deg, rgba(192,192,192,0.1), rgba(192,192,192,0.05));">
              <div class="d-flex align-items-center">
                <span class="me-3" style="font-size: 2rem;">ü•à</span>
                <div>
                  <p class="mb-0 fw-bold">Mayuri Chavan</p>
                  <small class="text-muted">TY Computer - A</small>
                </div>
              </div>
              <div class="text-end">
                <h4 class="mb-0 text-success fw-bold">94.5%</h4>
                <small class="text-muted">Avg Score</small>
              </div>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-4 p-3 rounded" style="background: linear-gradient(135deg, rgba(205,127,50,0.1), rgba(205,127,50,0.05));">
              <div class="d-flex align-items-center">
                <span class="me-3" style="font-size: 2rem;">ü•â</span>
                <div>
                  <p class="mb-0 fw-bold">Mittal Shisode</p>
                  <small class="text-muted">TY Computer - A</small>
                </div>
              </div>
              <div class="text-end">
                <h4 class="mb-0 text-success fw-bold">93.2%</h4>
                <small class="text-muted">Avg Score</small>
              </div>
            </div>
            <div class="d-flex justify-content-between align-items-center p-3 rounded" style="background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(102,126,234,0.05));">
              <div class="d-flex align-items-center">
                <span class="me-3" style="font-size: 1.8rem;">üèÜ</span>
                <div>
                  <p class="mb-0 fw-bold">Vaishnavi Desale</p>
                  <small class="text-muted">TY Computer - A</small>
                </div>
              </div>
              <div class="text-end">
                <h4 class="mb-0 text-success fw-bold">91.7%</h4>
                <small class="text-muted">Avg Score</small>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="col-lg-6">
        <div class="card border-0">
          <div class="card-header bg-white border-bottom">
            <h5 class="mb-1 fw-bold"><i class="bi bi-lightning-fill me-2 text-primary"></i>Quick Actions</h5>
            <small class="text-muted">Frequently used operations</small>
          </div>
          <div class="card-body p-4">
            <div class="row g-3">
              <div class="col-sm-6">
                <a href="add_student.html" class="btn btn-outline-primary w-100 py-3 text-start">
                  <i class="bi bi-person-plus fs-4 me-2"></i>
                  <div class="d-inline-block">
                    <div class="fw-bold">Add Student</div>
                    <small class="text-muted">Register new</small>
                  </div>
                </a>
              </div>
              <div class="col-sm-6">
                <a href="attendance.html" class="btn btn-outline-primary w-100 py-3 text-start">
                  <i class="bi bi-calendar-check fs-4 me-2"></i>
                  <div class="d-inline-block">
                    <div class="fw-bold">Attendance</div>
                    <small class="text-muted">Mark today</small>
                  </div>
                </a>
              </div>
              <div class="col-sm-6">
                <a href="marks.html" class="btn btn-outline-primary w-100 py-3 text-start">
                  <i class="bi bi-journal-text fs-4 me-2"></i>
                  <div class="d-inline-block">
                    <div class="fw-bold">Enter Marks</div>
                    <small class="text-muted">Add grades</small>
                  </div>
                </a>
              </div>
              <div class="col-sm-6">
                <a href="/students/" class="btn btn-primary w-100 py-3 text-start">
                  <i class="bi bi-people fs-4 me-2"></i>
                  <div class="d-inline-block">
                    <div class="fw-bold">View Students</div>
                    <small>All records</small>
                  </div>
                </a>
              </div>
            </div>
          </div>
              <a href="/students/" class="btn btn-outline-primary text-start">
                <i class="bi bi-people me-2"></i> View All Students
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="mt-4 text-center text-muted small">
      Student Information System - Demo ‚Ä¢ Frontend only
    </footer>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/script.js"></script>
<script>
// Dark Mode Toggle
const darkModeToggle = document.getElementById('darkModeToggle');
const htmlElement = document.documentElement;
const darkModeIcon = darkModeToggle.querySelector('i');

// Check for saved theme preference or default to light mode
const currentTheme = localStorage.getItem('theme') || 'light';
htmlElement.setAttribute('data-theme', currentTheme);
updateDarkModeIcon(currentTheme);

darkModeToggle.addEventListener('click', function() {
  const currentTheme = htmlElement.getAttribute('data-theme');
  const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
  
  htmlElement.setAttribute('data-theme', newTheme);
  localStorage.setItem('theme', newTheme);
  updateDarkModeIcon(newTheme);
});

function updateDarkModeIcon(theme) {
  if (theme === 'dark') {
    darkModeIcon.classList.remove('bi-moon-stars');
    darkModeIcon.classList.add('bi-sun');
  } else {
    darkModeIcon.classList.remove('bi-sun');
    darkModeIcon.classList.add('bi-moon-stars');
  }
}

// Initialize Performance Chart
let performanceChart = null;

function updateChart(year, division) {
  // Fetch data from API
  const params = new URLSearchParams();
  if (year) params.append('year', year);
  if (division) params.append('division', division);
  
  fetch(`${window.API_BASE}/performance-analytics/?${params.toString()}`)
    .then(response => response.json())
    .then(data => {
      if (performanceChart) {
        performanceChart.data.labels = data.labels;
        performanceChart.data.datasets[0].data = data.attendance;
        performanceChart.data.datasets[1].data = data.cgpa;
        performanceChart.update();
      }
      
      // Update chart title
      let titleText = 'Performance Analytics';
      if (year && division) {
        titleText += ` - ${year} Computer Division ${division}`;
      } else if (year) {
        titleText += ` - ${year} Computer (All Divisions)`;
      } else if (division) {
        titleText += ` - Division ${division} (All Years)`;
      }
      
      if (data.filter && data.filter.student_count) {
        titleText += ` <small class="text-muted">(${data.filter.student_count} students)</small>`;
      }
      
      document.querySelector('.card-header h5').innerHTML = `<i class="bi bi-bar-chart-line-fill me-2 text-primary"></i>${titleText}`;
    })
    .catch(error => {
      console.error('Error fetching performance data:', error);
    });
}

document.addEventListener('DOMContentLoaded', function() {
  const ctx = document.getElementById('performanceChart');
  if (ctx) {
    performanceChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
        datasets: [
          {
            label: 'Attendance %',
            data: [0, 0, 0, 0, 0, 0],
            borderColor: '#667eea',
            backgroundColor: 'rgba(102, 126, 234, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 5,
            pointHoverRadius: 7,
            yAxisID: 'y'
          },
          {
            label: 'Average CGPA',
            data: [0, 0, 0, 0, 0, 0],
            borderColor: '#f093fb',
            backgroundColor: 'rgba(240, 147, 251, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 5,
            pointHoverRadius: 7,
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            display: true,
            position: 'top',
            labels: {
              usePointStyle: true,
              padding: 15,
              font: {
                size: 13,
                family: 'Inter, sans-serif'
              }
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleFont: { size: 14 },
            bodyFont: { size: 13 },
            cornerRadius: 8
          }
        },
        scales: {
          y: {
            type: 'linear',
            display: true,
            position: 'left',
            beginAtZero: false,
            min: 70,
            max: 100,
            ticks: {
              callback: function(value) {
                return value + '%';
              }
            },
            grid: {
              color: 'rgba(0, 0, 0, 0.05)'
            },
            title: {
              display: true,
              text: 'Attendance %',
              color: '#667eea',
              font: {
                size: 12,
                weight: 'bold'
              }
            }
          },
          y1: {
            type: 'linear',
            display: true,
            position: 'right',
            beginAtZero: false,
            min: 6,
            max: 10,
            ticks: {
              callback: function(value) {
                return value.toFixed(1);
              }
            },
            grid: {
              drawOnChartArea: false
            },
            title: {
              display: true,
              text: 'CGPA (10-point scale)',
              color: '#f093fb',
              font: {
                size: 12,
                weight: 'bold'
              }
            }
          },
          x: {
            grid: {
              display: false
            }
          }
        }
      }
    });
    
    // Filter event listeners
    const yearFilter = document.getElementById('yearFilter');
    const divisionFilter = document.getElementById('divisionFilter');
    
    if (yearFilter) {
      yearFilter.addEventListener('change', function() {
        const year = this.value;
        const division = divisionFilter ? divisionFilter.value : '';
        updateChart(year, division);
      });
    }
    
    if (divisionFilter) {
      divisionFilter.addEventListener('change', function() {
        const year = yearFilter ? yearFilter.value : '';
        const division = this.value;
        updateChart(year, division);
      });
    }
    
    // Load initial data (default to all students)
    updateChart('', '');
  }
});
</script>
</body>
</html>
